<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Create RSO - College Event Website</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- Common Header -->
  <header>
    <h1>College Event Website</h1>
    <nav>
      <ul>
        <li><a href="dashboard.html">Dashboard</a></li>
        <li><a href="events.html">Events</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><a href="RSO.html">RSOs</a></li>
        <li><a href="login.html">Logout</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h2>Create New RSO</h2>
    <!-- RSO creation form -->
    <form id="create-rso-form">
      <label for="rso-name">RSO Name:</label>
      <input type="text" id="rso-name" name="name" required />

      <label for="university_ID">Select University:</label>
      <select id="university_ID" name="university_ID" required>
        <option value="">Loading universities...</option>
      </select>
      
      <button type="submit">Create RSO</button>
    </form>
    <div id="create-rso-result"></div>
  </main>

  <!-- Common Footer -->
  <footer>
    <p>&copy; 2025 College Event Website</p>
  </footer>

  <script>
    // Role check
    const user = JSON.parse(localStorage.getItem("user"));
    const userRole = localStorage.getItem("userRole");
    if (!(user && user.id && (userRole === "admin" || userRole === "superadmin"))) {
      alert("Unauthorized. Only admin users can create RSOs.");
      window.location.href = "dashboard.html";
    }

    fetch("api/fetchUniversities.php")
    .then((res) => res.json())
    .then((data) => {
      const select = document.getElementById("university_ID");
      select.innerHTML = ""; // Clear initial option

      if (data.success && data.universities.length > 0) {
        data.universities.forEach((uni) => {
          const option = document.createElement("option");
          option.value = uni.university_ID;
          option.textContent = uni.name;
          select.appendChild(option);
        });
      } else {
        select.innerHTML = '<option value="">No universities available</option>';
      }
    })
    .catch((err) => {
      console.error("Error fetching universities:", err);
      document.getElementById("university_ID").innerHTML =
        '<option value="">Error loading universities</option>';
    });

    // Form submit handler
    document.getElementById("create-rso-form").addEventListener("submit", function (e) {
      e.preventDefault();

      const name = document.getElementById("rso-name").value.trim();
      const university_ID = parseInt(document.getElementById("university_ID").value, 10);

      const payload = {
        name,
        university_ID,
        admin_ID: user.id
      };

      fetch("api/createRSO.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      })
        .then((res) => res.json())
        .then((data) => {
          const resultDiv = document.getElementById("create-rso-result");
          if (data.success) {
            resultDiv.innerHTML = "<p>RSO created successfully!</p>";
            e.target.reset();
          } else {
            resultDiv.innerHTML = `<p>Error: ${data.error}</p>`;
          }
        })
        .catch((err) => {
          console.error("Error creating RSO:", err);
          document.getElementById("create-rso-result").innerHTML =
            "<p>Error creating RSO. Please try again.</p>";
        });
    });
  </script>
</body>
</html>
